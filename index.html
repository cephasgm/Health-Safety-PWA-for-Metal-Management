<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MMS Safety Dashboard">
    <meta name="theme-color" content="#1a3568">
    <title>MMS Health & Safety Management</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary: #1a3568;
            --primary-dark: #0d1c3a;
            --secondary: #2d5aa0;
            --accent: #e63946;
            --success: #27ae60;
            --warning: #f39c12;
            --error: #e74c3c;
            --background: #0d1c3a;
            --surface: rgba(255, 255, 255, 0.95);
            --text: #000000;
            --text-light: #b8c2cc;
            --border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Roboto', system-ui, sans-serif;
            background: linear-gradient(rgba(13, 28, 58, 0.9), rgba(13, 28, 58, 0.9)), 
                        url('https://static.wixstatic.com/media/265674_d5cb0bde041641db9cdee64616802e99~mv2.jpg/v1/fill/w_980,h_549,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/265674_d5cb0bde041641db9cdee64616802e99~mv2.jpg');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
            backdrop-filter: blur(10px);
        }

        .sidebar {
            background: rgba(26, 53, 104, 0.95);
            padding: 2rem 1rem;
            position: fixed;
            width: 280px;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 2.5rem;
            padding: 0 1rem;
            text-decoration: none;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: white;
            padding: 4px;
        }

        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .logo-text {
            color: white;
        }

        .logo-text h2 {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .logo-text p {
            font-size: 0.75rem;
            opacity: 0.9;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: rgba(255,255,255,0.6);
            margin-bottom: 1rem;
            padding: 0 1rem;
            letter-spacing: 0.5px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.2s;
            margin-bottom: 0.25rem;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.15);
            color: white;
            transform: translateX(5px);
        }

        .nav-icon {
            font-size: 1.25rem;
            width: 24px;
            text-align: center;
        }

        .main-content {
            grid-column: 2;
            padding: 2rem;
            margin-left: 280px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
            background: var(--surface);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            border: 1px solid var(--border);
        }

        .header h1 {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* Statistics Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(26, 53, 104, 0.2);
            border-color: var(--primary);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .stat-subtitle {
            color: var(--text-light);
            font-size: 0.85rem;
        }

        /* Chart Container */
        .chart-container {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
            height: 400px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
        }

        .chart-subtitle {
            color: var(--text-light);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        /* Enhanced Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .data-table th,
        .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .data-table th {
            background: rgba(26, 53, 104, 0.1);
            font-weight: 600;
            color: var(--primary);
            position: sticky;
            top: 0;
        }

        .data-table tbody tr:hover {
            background: rgba(26, 53, 104, 0.05);
        }

        .data-table td.editable {
            cursor: pointer;
            position: relative;
            transition: background-color 0.2s;
        }

        .data-table td.editable:hover {
            background: rgba(26, 53, 104, 0.1);
        }

        .data-table td.editing {
            background: rgba(26, 53, 104, 0.1);
            border: 1px solid var(--primary);
            border-radius: 4px;
            padding: 0.5rem;
        }

        .edit-input {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid var(--primary);
            border-radius: 6px;
            font-family: inherit;
            font-size: inherit;
            background: var(--surface);
            color: var(--text);
            outline: none;
        }

        .edit-select {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid var(--primary);
            border-radius: 6px;
            font-family: inherit;
            font-size: inherit;
            background: var(--surface);
            color: var(--text);
            outline: none;
        }

        /* Buttons */
        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(26, 53, 104, 0.3);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 400px;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: var(--surface);
            margin: 2% auto;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 900px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            color: var(--text-light);
            border-top: 1px solid var(--border);
            font-size: 0.9rem;
            background: var(--surface);
            border-radius: 12px;
        }

        /* Country Filter */
        .country-filter {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .country-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--surface);
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s;
        }

        .country-btn:hover, .country-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Module Grid */
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .module-card {
            background: var(--surface);
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: inherit;
            display: block;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .module-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(26, 53, 104, 0.2);
            border-color: var(--primary);
        }

        /* Settings Modal */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .setting-card {
            background: rgba(26, 53, 104, 0.1);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
                grid-column: 1;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            .header {
                flex-direction: column;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .module-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <nav class="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <!-- MMS Logo -->
                    <img src="icon-192.png" alt="MMS Logo">
                </div>
                <div class="logo-text">
                    <h2>Metal Management Solutions</h2>
                    <p>Health & Safety System</p>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-title">Navigation</div>
                <button class="nav-item active" onclick="showDashboard()">
                    <span class="nav-icon">üìä</span>
                    Dashboard
                </button>
                <button class="nav-item" onclick="openModal('employeeModal')">
                    <span class="nav-icon">üë•</span>
                    Employee Management
                </button>
                <button class="nav-item" onclick="openModal('incidentsModal')">
                    <span class="nav-icon">üö®</span>
                    Incidents
                </button>
            </div>

            <div class="nav-section">
                <div class="nav-title">Safety Management</div>
                <button class="nav-item" onclick="openModal('trainingModal')">
                    <span class="nav-icon">üéì</span>
                    Safety Training
                </button>
                <button class="nav-item" onclick="openModal('ppeModal')">
                    <span class="nav-icon">ü•Ω</span>
                    PPE Management
                </button>
                <button class="nav-item" onclick="openModal('contractorModal')">
                    <span class="nav-icon">üë∑</span>
                    Contractor Safety
                </button>
            </div>

            <div class="nav-section">
                <div class="nav-title">Compliance</div>
                <button class="nav-item" onclick="openModal('auditModal')">
                    <span class="nav-icon">üîç</span>
                    Audit & Inspection
                </button>
                <button class="nav-item" onclick="openModal('standardsModal')">
                    <span class="nav-icon">üìã</span>
                    Standards & Compliance
                </button>
            </div>

            <div class="nav-section">
                <div class="nav-title">Regional Operations</div>
                <button class="nav-item" onclick="filterData('South Africa')">
                    <span class="nav-icon">üáøüá¶</span>
                    South Africa
                </button>
                <button class="nav-item" onclick="filterData('Tanzania')">
                    <span class="nav-icon">üáπüáø</span>
                    Tanzania
                </button>
                <button class="nav-item" onclick="filterData('Namibia')">
                    <span class="nav-icon">üá≥üá¶</span>
                    Namibia
                </button>
                <button class="nav-item" onclick="filterData('Zambia')">
                    <span class="nav-icon">üáøüá≤</span>
                    Zambia
                </button>
            </div>

            <div class="nav-section">
                <div class="nav-title">System</div>
                <button class="nav-item" onclick="exportPDF()">
                    <span class="nav-icon">üì§</span>
                    Export PDF
                </button>
                <button class="nav-item" onclick="openModal('settingsModal')">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    Settings
                </button>
            </div>
        </nav>

        <main class="main-content" id="mainContent">
            <div class="header">
                <div>
                    <h1>MMS Health & Safety Management</h1>
                    <div style="color: var(--text-light); margin-top: 0.5rem;">
                        Comprehensive safety monitoring across 16 facilities in 4 countries
                    </div>
                    <div class="country-filter" id="countryFilter">
                        <button class="country-btn" onclick="filterData('All')">All Countries</button>
                        <button class="country-btn" onclick="filterData('South Africa')">South Africa</button>
                        <button class="country-btn" onclick="filterData('Tanzania')">Tanzania</button>
                        <button class="country-btn" onclick="filterData('Namibia')">Namibia</button>
                        <button class="country-btn" onclick="filterData('Zambia')">Zambia</button>
                    </div>
                </div>
                <div>
                    <button class="btn btn-primary" onclick="openModal('reportIncidentModal')">
                        üö® Report New Incident
                    </button>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card" onclick="openModal('employeeModal')">
                    <div class="stat-number" id="totalEmployees">34</div>
                    <div class="stat-label">Total Employees</div>
                    <div class="stat-subtitle">Across 16 locations in 4 countries</div>
                </div>
                <div class="stat-card" onclick="openModal('incidentsModal')">
                    <div class="stat-number" id="lostTimeInjuries">0</div>
                    <div class="stat-label">Lost Time Injuries</div>
                    <div class="stat-subtitle">365 days incident-free</div>
                </div>
                <div class="stat-card" onclick="openModal('trainingModal')">
                    <div class="stat-number" id="safetyTrainings">156</div>
                    <div class="stat-label">Safety Trainings</div>
                    <div class="stat-subtitle">Completed this year</div>
                </div>
                <div class="stat-card" onclick="openModal('standardsModal')">
                    <div class="stat-number" id="complianceRate">100%</div>
                    <div class="stat-label">Compliance Rate</div>
                    <div class="stat-subtitle">Based on 45 standards</div>
                </div>
            </div>

            <!-- Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Safety Performance Trends</div>
                        <div class="chart-subtitle">Incident monitoring across MMS facilities</div>
                    </div>
                </div>
                <div style="flex: 1; position: relative;">
                    <canvas id="safetyChart"></canvas>
                </div>
            </div>

            <!-- Recent Incidents -->
            <div class="chart-container">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Recent Incidents</div>
                        <div class="chart-subtitle">Last 30 days - Click to edit</div>
                    </div>
                    <div>
                        <button class="btn btn-primary" onclick="openModal('reportIncidentModal')">
                            + Report Incident
                        </button>
                    </div>
                </div>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Location</th>
                                <th>Country</th>
                                <th>Severity</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recentIncidentsTable">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Safety Management Modules -->
            <div class="module-grid">
                <div class="module-card" onclick="openModal('incidentsModal')">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üö®</div>
                    <h3>Incident Management</h3>
                    <p>Report, track, and investigate workplace incidents</p>
                </div>

                <div class="module-card" onclick="openModal('ppeModal')">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ü•Ω</div>
                    <h3>PPE Management</h3>
                    <p>Track personal protective equipment</p>
                </div>

                <div class="module-card" onclick="openModal('employeeModal')">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üë•</div>
                    <h3>Employee Safety</h3>
                    <p>Manage employee safety records and training</p>
                </div>

                <div class="module-card" onclick="openModal('contractorModal')">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üë∑</div>
                    <h3>Contractor Safety</h3>
                    <p>Manage contractor safety compliance</p>
                </div>

                <div class="module-card" onclick="openModal('auditModal')">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üîç</div>
                    <h3>Audit & Inspection</h3>
                    <p>Schedule and conduct safety audits</p>
                </div>

                <div class="module-card" onclick="openModal('standardsModal')">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìã</div>
                    <h3>Standards Compliance</h3>
                    <p>Manage international and national standards</p>
                </div>
            </div>

            <div class="footer">
                <div style="margin-bottom: 0.5rem; font-weight: 600; color: var(--primary);">
                    Metal Management Solutions
                </div>
                <div style="margin-bottom: 1rem; color: var(--text-light);">
                    Health & Safety Management System
                </div>
                <div style="font-size: 0.8rem; color: var(--text-light);">
                    Copyright ¬© 2026 Metal Management Solutions. All rights reserved.
                    <br>Operating in South Africa, Tanzania, Namibia, and Zambia
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon" id="toastIcon"></div>
        <div class="toast-content">
            <div class="toast-title" id="toastTitle"></div>
            <div class="toast-message" id="toastMessage"></div>
        </div>
        <button class="close-toast" onclick="hideToast()">√ó</button>
    </div>

    <!-- Report Incident Modal -->
    <div id="reportIncidentModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('reportIncidentModal')">√ó</button>
            <div class="modal-header">
                <h2>Report Safety Incident</h2>
            </div>
            
            <div class="success-message" id="reportSuccess" style="display: none;">Incident reported successfully!</div>
            <div class="error-message" id="reportError" style="display: none;">Please fill all required fields.</div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <div>
                    <label>Incident Type *</label>
                    <select id="incidentType" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; background: var(--surface); color: var(--text);">
                        <option value="">Select type</option>
                        <option value="Near Miss">Near Miss</option>
                        <option value="First Aid">First Aid</option>
                        <option value="Medical Treatment">Medical Treatment</option>
                        <option value="Lost Time Injury">Lost Time Injury</option>
                    </select>
                </div>
                <div>
                    <label>Severity *</label>
                    <select id="incidentSeverity" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; background: var(--surface); color: var(--text);">
                        <option value="">Select severity</option>
                        <option value="Minor">Minor</option>
                        <option value="Moderate">Moderate</option>
                        <option value="Serious">Serious</option>
                        <option value="Critical">Critical</option>
                    </select>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <div>
                    <label>Country *</label>
                    <select id="incidentCountry" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; background: var(--surface); color: var(--text);">
                        <option value="">Select country</option>
                        <option value="South Africa">South Africa</option>
                        <option value="Tanzania">Tanzania</option>
                        <option value="Namibia">Namibia</option>
                        <option value="Zambia">Zambia</option>
                    </select>
                </div>
                <div>
                    <label>Location *</label>
                    <input type="text" id="incidentLocation" placeholder="Enter location" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; background: var(--surface); color: var(--text);">
                </div>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <label>Reported By *</label>
                <select id="reportedBy" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; background: var(--surface); color: var(--text);">
                    <option value="">Select employee</option>
                </select>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <label>Description *</label>
                <textarea id="incidentDescription" rows="4" placeholder="Provide detailed description" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; background: var(--surface); color: var(--text);"></textarea>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                <button class="btn btn-primary" onclick="submitIncident()" style="flex: 1;">Submit Report</button>
                <button class="btn" onclick="closeModal('reportIncidentModal')" style="flex: 1; background: var(--border);">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Employee Management Modal -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('employeeModal')">√ó</button>
            <div class="modal-header">
                <h2>MMS Employee Management</h2>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <button class="btn btn-primary" onclick="addEmployee()">+ Add Employee</button>
                <button class="btn" onclick="exportEmployeePDF()" style="margin-left: 1rem;">üìÑ Export PDF</button>
            </div>
            
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Country</th>
                            <th>Location</th>
                            <th>Safety Training</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="employeeTable">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Incident Management Modal -->
    <div id="incidentsModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('incidentsModal')">√ó</button>
            <div class="modal-header">
                <h2>Incident Management System</h2>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <button class="btn btn-primary" onclick="openModal('reportIncidentModal')">+ Report Incident</button>
                <button class="btn" onclick="exportIncidentsPDF()" style="margin-left: 1rem;">üìÑ Export PDF</button>
            </div>
            
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Type</th>
                            <th>Date</th>
                            <th>Location</th>
                            <th>Country</th>
                            <th>Reported By</th>
                            <th>Severity</th>
                            <th>Status</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="incidentsTable">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Safety Training Modal -->
    <div id="trainingModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('trainingModal')">√ó</button>
            <div class="modal-header">
                <h2>Safety Training Management</h2>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <button class="btn btn-primary" onclick="addTraining()">+ Add Training</button>
                <button class="btn" onclick="exportTrainingPDF()" style="margin-left: 1rem;">üìÑ Export PDF</button>
            </div>
            
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Training ID</th>
                            <th>Course Name</th>
                            <th>Employee</th>
                            <th>Country</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Certificate</th>
                            <th>Attachments</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="trainingTable">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- PPE Management Modal -->
    <div id="ppeModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('ppeModal')">√ó</button>
            <div class="modal-header">
                <h2>PPE Management System</h2>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <button class="btn btn-primary" onclick="addPPE()">+ Add PPE Item</button>
                <button class="btn" onclick="exportPPEPDF()" style="margin-left: 1rem;">üìÑ Export PDF</button>
            </div>
            
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>PPE ID</th>
                            <th>Equipment Type</th>
                            <th>Assigned To</th>
                            <th>Country</th>
                            <th>Issue Date</th>
                            <th>Expiry Date</th>
                            <th>Status</th>
                            <th>Condition</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="ppeTable">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Contractor Safety Modal -->
    <div id="contractorModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('contractorModal')">√ó</button>
            <div class="modal-header">
                <h2>Contractor Safety Management</h2>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <button class="btn btn-primary" onclick="addContractor()">+ Add Contractor</button>
                <button class="btn" onclick="exportContractorPDF()" style="margin-left: 1rem;">üìÑ Export PDF</button>
            </div>
            
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Contractor ID</th>
                            <th>Company</th>
                            <th>Contact Person</th>
                            <th>Country</th>
                            <th>Work Type</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Safety Rating</th>
                            <th>Attachments</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="contractorTable">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Audit & Inspection Modal -->
    <div id="auditModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('auditModal')">√ó</button>
            <div class="modal-header">
                <h2>Audit & Inspection Management</h2>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <button class="btn btn-primary" onclick="addAudit()">+ Schedule Audit</button>
                <button class="btn" onclick="exportAuditPDF()" style="margin-left: 1rem;">üìÑ Export PDF</button>
            </div>
            
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Audit ID</th>
                            <th>Type</th>
                            <th>Country</th>
                            <th>Location</th>
                            <th>Audit Date</th>
                            <th>Auditor</th>
                            <th>Score</th>
                            <th>Status</th>
                            <th>Findings</th>
                            <th>Attachments</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="auditTable">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Standards & Compliance Modal -->
    <div id="standardsModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('standardsModal')">√ó</button>
            <div class="modal-header">
                <h2>Standards & Compliance Management</h2>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <button class="btn btn-primary" onclick="addStandard()">+ Add Standard</button>
                <button class="btn" onclick="exportStandardsPDF()" style="margin-left: 1rem;">üìÑ Export PDF</button>
            </div>
            
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Standard ID</th>
                            <th>Name</th>
                            <th>Code</th>
                            <th>Type</th>
                            <th>Industry</th>
                            <th>Status</th>
                            <th>Effective Date</th>
                            <th>Remarks</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="standardsTable">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('settingsModal')">√ó</button>
            <div class="modal-header">
                <h2>System Settings</h2>
            </div>
            
            <div class="settings-grid">
                <div class="setting-card">
                    <h3 style="margin-bottom: 1rem; color: var(--primary);">Data Management</h3>
                    <button class="btn" onclick="backupData()" style="width: 100%; margin-bottom: 0.5rem;">üíæ Backup Data</button>
                    <button class="btn" onclick="restoreData()" style="width: 100%; margin-bottom: 0.5rem;">üì• Restore Data</button>
                    <button class="btn" onclick="resetData()" style="width: 100%; background: var(--error); color: white;">üîÑ Reset All Data</button>
                </div>
                
                <div class="setting-card">
                    <h3 style="margin-bottom: 1rem; color: var(--primary);">System Configuration</h3>
                    <div style="margin-bottom: 1rem;">
                        <label>Theme Color</label>
                        <select id="themeColor" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px; background: var(--surface); color: var(--text);">
                            <option value="dark">Dark Theme</option>
                            <option value="light">Light Theme</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <label>Language</label>
                        <select style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px; background: var(--surface); color: var(--text);">
                            <option>English</option>
                            <option>Swahili</option>
                            <option>Afrikaans</option>
                        </select>
                    </div>
                </div>
                
                <div class="setting-card">
                    <h3 style="margin-bottom: 1rem; color: var(--primary);">Notifications</h3>
                    <div style="margin-bottom: 1rem;">
                        <input type="checkbox" id="emailNotifications" checked>
                        <label for="emailNotifications">Email Notifications</label>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <input type="checkbox" id="pushNotifications" checked>
                        <label for="pushNotifications">Push Notifications</label>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <input type="checkbox" id="reportReminders" checked>
                        <label for="reportReminders">Report Reminders</label>
                    </div>
                </div>
                
                <div class="setting-card">
                    <h3 style="margin-bottom: 1rem; color: var(--primary);">Export Settings</h3>
                    <div style="margin-bottom: 1rem;">
                        <label>Default Export Format</label>
                        <select style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px; background: var(--surface); color: var(--text);">
                            <option>PDF</option>
                            <option>Excel</option>
                            <option>CSV</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <label>Include in Export</label>
                        <div>
                            <input type="checkbox" id="exportEmployees" checked> <label for="exportEmployees">Employees</label>
                        </div>
                        <div>
                            <input type="checkbox" id="exportIncidents" checked> <label for="exportIncidents">Incidents</label>
                        </div>
                        <div>
                            <input type="checkbox" id="exportTrainings" checked> <label for="exportTrainings">Trainings</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                <button class="btn btn-primary" onclick="saveSettings()" style="flex: 1;">Save Settings</button>
                <button class="btn" onclick="closeModal('settingsModal')" style="flex: 1; background: var(--border);">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let employees = [];
        let incidents = [];
        let trainings = [];
        let ppeItems = [];
        let contractors = [];
        let audits = [];
        let standards = [];
        let currentFilter = 'All';
        let editingCell = null;

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            initializeCharts();
            loadAllTables();
            updateStatistics();
            setupEventListeners();
        });

        function loadAllData() {
            // Load from localStorage or use default data
            employees = JSON.parse(localStorage.getItem('mms_employees')) || getDefaultEmployees();
            incidents = JSON.parse(localStorage.getItem('mms_incidents')) || getDefaultIncidents();
            trainings = JSON.parse(localStorage.getItem('mms_trainings')) || getDefaultTrainings();
            ppeItems = JSON.parse(localStorage.getItem('mms_ppe')) || getDefaultPPE();
            contractors = JSON.parse(localStorage.getItem('mms_contractors')) || getDefaultContractors();
            audits = JSON.parse(localStorage.getItem('mms_audits')) || getDefaultAudits();
            standards = JSON.parse(localStorage.getItem('mms_standards')) || getDefaultStandards();
        }

        function saveAllData() {
            localStorage.setItem('mms_employees', JSON.stringify(employees));
            localStorage.setItem('mms_incidents', JSON.stringify(incidents));
            localStorage.setItem('mms_trainings', JSON.stringify(trainings));
            localStorage.setItem('mms_ppe', JSON.stringify(ppeItems));
            localStorage.setItem('mms_contractors', JSON.stringify(contractors));
            localStorage.setItem('mms_audits', JSON.stringify(audits));
            localStorage.setItem('mms_standards', JSON.stringify(standards));
        }

        function getDefaultEmployees() {
            return [
                // Tanzania
                { id: 'TZ-001', name: 'Cephas Gideon Mkama', position: 'Inventory Control Specialist', country: 'Tanzania', location: 'Impala Dar', status: 'Active', training: 'Completed' },
                { id: 'TZ-002', name: 'Salman Esmail', position: 'Inventory Control Specialist', country: 'Tanzania', location: 'Polytra Dar', status: 'Active', training: 'Pending' },
                
                // Namibia
                { id: 'NA-001', name: 'Leon Fourie', position: 'Inventory Control Specialist', country: 'Namibia', location: 'WBCT Bulk Shed', status: 'Active', training: 'Completed' },
                { id: 'NA-002', name: 'Salomon Iyambo', position: 'Inventory Control Specialist', country: 'Namibia', location: 'WBCT Quay Side Shed', status: 'Active', training: 'Completed' },
                { id: 'NA-003', name: 'Sakeus Iyambo', position: 'Inventory Control Specialist', country: 'Namibia', location: 'Bridge Walvis Bay', status: 'Active', training: 'Pending' },
                
                // South Africa
                { id: 'SA-001', name: 'Katlego Matsane', position: 'Inventory Control Specialist', country: 'South Africa', location: 'Cape Town (HQ)', status: 'Active', training: 'Completed' },
                { id: 'SA-002', name: 'Bonnie Sibande', position: 'Inventory Control Specialist', country: 'South Africa', location: 'Durban', status: 'Active', training: 'Completed' },
                
                // Zambia - All 27 employees
                { id: 'ZM-001', name: 'Alick Banda', position: '', country: 'Zambia', location: 'Reload Giga Terminal', status: 'Active', training: 'Pending' },
                { id: 'ZM-002', name: 'Alinaswe Mwanamoonga', position: '', country: 'Zambia', location: 'AGL Chingola Hub', status: 'Active', training: 'Pending' },
                { id: 'ZM-003', name: 'Caleb Simpanzye', position: '', country: 'Zambia', location: 'Polytra Kitwe', status: 'Active', training: 'Pending' },
                { id: 'ZM-004', name: 'Cephas Phiri', position: '', country: 'Zambia', location: 'Impala Ndola', status: 'Active', training: 'Pending' },
                { id: 'ZM-005', name: 'Changwa Sikombe', position: '', country: 'Zambia', location: 'SLS Ndola', status: 'Active', training: 'Pending' },
                { id: 'ZM-006', name: 'Chiti Mwamba', position: '', country: 'Zambia', location: 'Poseidon Zambia', status: 'Active', training: 'Pending' },
                { id: 'ZM-007', name: 'Edward Vyande', position: '', country: 'Zambia', location: 'Polytra Kapiri Mposhi', status: 'Active', training: 'Pending' },
                { id: 'ZM-008', name: 'Given Phiri', position: '', country: 'Zambia', location: 'AGL Chingola Hub', status: 'Active', training: 'Pending' },
                { id: 'ZM-009', name: 'Happie M\'gode', position: '', country: 'Zambia', location: 'Polytra Kitwe', status: 'Active', training: 'Pending' },
                { id: 'ZM-010', name: 'Ivan Mbewe', position: '', country: 'Zambia', location: 'Impala Ndola', status: 'Active', training: 'Pending' },
                { id: 'ZM-011', name: 'Joseph Banda', position: '', country: 'Zambia', location: 'SLS Ndola', status: 'Active', training: 'Pending' },
                { id: 'ZM-012', name: 'Julius Makambwe', position: '', country: 'Zambia', location: 'Poseidon Zambia', status: 'Active', training: 'Pending' },
                { id: 'ZM-013', name: 'Malambo Kozi', position: '', country: 'Zambia', location: 'Polytra Kapiri Mposhi', status: 'Active', training: 'Pending' },
                { id: 'ZM-014', name: 'Miles Kaweche', position: '', country: 'Zambia', location: 'Reload Giga Terminal', status: 'Active', training: 'Pending' },
                { id: 'ZM-015', name: 'Zachariah Musonda', position: '', country: 'Zambia', location: 'AGL Chingola Hub', status: 'Active', training: 'Pending' },
                { id: 'ZM-016', name: 'Mutandi Kalaluka', position: '', country: 'Zambia', location: 'Polytra Kitwe', status: 'Active', training: 'Pending' },
                { id: 'ZM-017', name: 'Natasha Tembo', position: '', country: 'Zambia', location: 'Impala Ndola', status: 'Active', training: 'Pending' },
                { id: 'ZM-018', name: 'Patrick Mwale', position: '', country: 'Zambia', location: 'SLS Ndola', status: 'Active', training: 'Pending' },
                { id: 'ZM-019', name: 'Phius Mweene', position: '', country: 'Zambia', location: 'Poseidon Zambia', status: 'Active', training: 'Pending' },
                { id: 'ZM-020', name: 'Richard Phiri', position: '', country: 'Zambia', location: 'Polytra Kapiri Mposhi', status: 'Active', training: 'Pending' },
                { id: 'ZM-021', name: 'Gerald Mwale', position: '', country: 'Zambia', location: 'Reload Giga Terminal', status: 'Active', training: 'Pending' },
                { id: 'ZM-022', name: 'Jackson Chola', position: '', country: 'Zambia', location: 'AGL Chingola Hub', status: 'Active', training: 'Pending' },
                { id: 'ZM-023', name: 'Michael Mwate', position: '', country: 'Zambia', location: 'Polytra Kitwe', status: 'Active', training: 'Pending' },
                { id: 'ZM-024', name: 'Mfula Mighty', position: '', country: 'Zambia', location: 'Impala Ndola', status: 'Active', training: 'Pending' },
                { id: 'ZM-025', name: 'Richard Mwaba', position: '', country: 'Zambia', location: 'SLS Ndola', status: 'Active', training: 'Pending' },
                { id: 'ZM-026', name: 'David Muzeka', position: '', country: 'Zambia', location: 'Poseidon Zambia', status: 'Active', training: 'Pending' },
                { id: 'ZM-027', name: 'Yamba Yamba', position: '', country: 'Zambia', location: 'Polytra Kapiri Mposhi', status: 'Active', training: 'Pending' }
            ];
        }

        function getDefaultIncidents() {
            return [
                {
                    id: 'INC-2024-001',
                    type: 'Near Miss',
                    severity: 'Minor',
                    location: 'Cape Town (HQ)',
                    country: 'South Africa',
                    reportedBy: 'SA-001',
                    date: '2024-01-15',
                    status: 'Resolved',
                    description: 'Forklift almost collided with pedestrian.'
                }
            ];
        }

        function getDefaultTrainings() {
            return [
                {
                    id: 'TRN-001',
                    course: 'NOSHC 1 & 2 - OSHA Tanzania',
                    employee: 'Cephas Gideon Mkama',
                    employeeId: 'TZ-001',
                    country: 'Tanzania',
                    date: '2024-01-15',
                    status: 'Completed',
                    certificate: 'Yes',
                    attachments: ['certificate.pdf']
                },
                {
                    id: 'TRN-002',
                    course: 'NEBOSH International General Certificate',
                    employee: 'Cephas Gideon Mkama',
                    employeeId: 'TZ-001',
                    country: 'Tanzania',
                    date: '2024-03-01',
                    status: 'In Progress',
                    certificate: 'No',
                    attachments: []
                }
            ];
        }

        function getDefaultPPE() {
            return [
                {
                    id: 'PPE-001',
                    type: 'Safety Helmet',
                    assignedTo: 'Cephas Gideon Mkama',
                    assignedToId: 'TZ-001',
                    country: 'Tanzania',
                    issueDate: '2024-01-15',
                    expiryDate: '2025-01-15',
                    status: 'Active',
                    condition: 'Good'
                }
            ];
        }

        function getDefaultContractors() {
            return [
                {
                    id: 'CTR-001',
                    company: 'ABC Construction Ltd',
                    contactPerson: 'John Doe',
                    country: 'South Africa',
                    workType: 'Building Maintenance',
                    startDate: '2024-01-01',
                    endDate: '2024-12-31',
                    safetyRating: 'A',
                    attachments: ['contract.pdf', 'certificates.zip']
                }
            ];
        }

        function getDefaultAudits() {
            return [
                {
                    id: 'AUD-001',
                    type: 'Safety Audit',
                    country: 'South Africa',
                    location: 'Cape Town (HQ)',
                    auditDate: '2024-02-15',
                    auditor: 'Safety Officer',
                    score: '92%',
                    status: 'Completed',
                    findings: 'Minor issues identified',
                    attachments: ['audit_report.pdf']
                }
            ];
        }

        function getDefaultStandards() {
            return [
                {
                    id: 'STD-001',
                    name: 'ISO 45001:2018',
                    code: 'ISO45001',
                    type: 'International',
                    industry: 'General Industry',
                    status: 'Compliant',
                    effectiveDate: '2024-01-01',
                    remarks: 'Fully implemented'
                }
            ];
        }

        function updateStatistics() {
            let filteredEmployees = currentFilter === 'All' ? employees : employees.filter(e => e.country === currentFilter);
            let filteredIncidents = currentFilter === 'All' ? incidents : incidents.filter(i => i.country === currentFilter);
            let filteredTrainings = currentFilter === 'All' ? trainings : trainings.filter(t => t.country === currentFilter);
            
            document.getElementById('totalEmployees').textContent = filteredEmployees.length;
            document.getElementById('lostTimeInjuries').textContent = filteredIncidents.filter(i => i.type === 'Lost Time Injury').length;
            document.getElementById('safetyTrainings').textContent = filteredTrainings.filter(t => t.status === 'Completed').length;
            document.getElementById('complianceRate').textContent = '100%';
        }

        function initializeCharts() {
            const ctx = document.getElementById('safetyChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Incidents',
                        data: [2, 1, 0, 1, 0, 0],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 2,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function loadAllTables() {
            loadEmployeeTable();
            loadIncidentsTable();
            loadTrainingTable();
            loadPPETable();
            loadContractorTable();
            loadAuditTable();
            loadStandardsTable();
            loadRecentIncidents();
            populateEmployeeDropdown();
        }

        function loadEmployeeTable() {
            const table = document.getElementById('employeeTable');
            if (!table) return;
            
            let filteredEmployees = currentFilter === 'All' ? employees : employees.filter(e => e.country === currentFilter);
            
            table.innerHTML = '';
            filteredEmployees.forEach((emp, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${emp.id}</td>
                    <td class="editable" onclick="editCell(this, 'employees', ${index}, 'name')">${emp.name}</td>
                    <td class="editable" onclick="editCell(this, 'employees', ${index}, 'position')">${emp.position || ''}</td>
                    <td class="editable" onclick="editCell(this, 'employees', ${index}, 'country')">${emp.country}</td>
                    <td class="editable" onclick="editCell(this, 'employees', ${index}, 'location')">${emp.location}</td>
                    <td class="editable" onclick="editCell(this, 'employees', ${index}, 'training')">${emp.training}</td>
                    <td><span style="color: ${emp.status === 'Active' ? '#27ae60' : '#e74c3c'}">${emp.status}</span></td>
                    <td>
                        <button class="btn-sm" onclick="deleteEmployee(${index})" style="background: #e74c3c; color: white;">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadIncidentsTable() {
            const table = document.getElementById('incidentsTable');
            const recentTable = document.getElementById('recentIncidentsTable');
            
            let filteredIncidents = currentFilter === 'All' ? incidents : incidents.filter(i => i.country === currentFilter);
            
            // Main incidents table
            if (table) {
                table.innerHTML = '';
                filteredIncidents.forEach((inc, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${inc.id}</td>
                        <td class="editable" onclick="editCell(this, 'incidents', ${index}, 'type')">${inc.type}</td>
                        <td>${inc.date}</td>
                        <td class="editable" onclick="editCell(this, 'incidents', ${index}, 'location')">${inc.location}</td>
                        <td class="editable" onclick="editCell(this, 'incidents', ${index}, 'country')">${inc.country}</td>
                        <td>${getEmployeeName(inc.reportedBy)}</td>
                        <td class="editable" onclick="editCell(this, 'incidents', ${index}, 'severity')">${inc.severity}</td>
                        <td class="editable" onclick="editCell(this, 'incidents', ${index}, 'status')">${inc.status}</td>
                        <td class="editable" onclick="editCell(this, 'incidents', ${index}, 'description')">${inc.description}</td>
                        <td>
                            <button class="btn-sm" onclick="deleteIncident(${index})" style="background: #e74c3c; color: white;">Delete</button>
                        </td>
                    `;
                    table.appendChild(row);
                });
            }
            
            // Recent incidents table (last 30 days)
            if (recentTable) {
                recentTable.innerHTML = '';
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                const recentIncidents = filteredIncidents.filter(inc => new Date(inc.date) >= thirtyDaysAgo);
                
                recentIncidents.forEach((inc, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${inc.id}</td>
                        <td>${inc.type}</td>
                        <td>${inc.date}</td>
                        <td>${inc.location}</td>
                        <td>${inc.country}</td>
                        <td>${inc.severity}</td>
                        <td>${inc.status}</td>
                        <td>
                            <button class="btn-sm" onclick="deleteIncident(${index})" style="background: #e74c3c; color: white;">Delete</button>
                        </td>
                    `;
                    recentTable.appendChild(row);
                });
            }
        }

        function loadTrainingTable() {
            const table = document.getElementById('trainingTable');
            if (!table) return;
            
            let filteredTrainings = currentFilter === 'All' ? trainings : trainings.filter(t => t.country === currentFilter);
            
            table.innerHTML = '';
            filteredTrainings.forEach((training, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${training.id}</td>
                    <td class="editable" onclick="editCell(this, 'trainings', ${index}, 'course')">${training.course}</td>
                    <td class="editable" onclick="editCell(this, 'trainings', ${index}, 'employee')">${training.employee}</td>
                    <td class="editable" onclick="editCell(this, 'trainings', ${index}, 'country')">${training.country}</td>
                    <td class="editable" onclick="editCell(this, 'trainings', ${index}, 'date')">${training.date}</td>
                    <td class="editable" onclick="editCell(this, 'trainings', ${index}, 'status')">${training.status}</td>
                    <td class="editable" onclick="editCell(this, 'trainings', ${index}, 'certificate')">${training.certificate}</td>
                    <td>${training.attachments ? training.attachments.length : 0} files</td>
                    <td>
                        <button class="btn-sm" onclick="uploadTrainingAttachment(${index})" style="margin-right: 0.5rem;">üìé</button>
                        <button class="btn-sm" onclick="deleteTraining(${index})" style="background: #e74c3c; color: white;">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadPPETable() {
            const table = document.getElementById('ppeTable');
            if (!table) return;
            
            let filteredPPE = currentFilter === 'All' ? ppeItems : ppeItems.filter(p => p.country === currentFilter);
            
            table.innerHTML = '';
            filteredPPE.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.id}</td>
                    <td class="editable" onclick="editCell(this, 'ppeItems', ${index}, 'type')">${item.type}</td>
                    <td class="editable" onclick="editCell(this, 'ppeItems', ${index}, 'assignedTo')">${item.assignedTo}</td>
                    <td class="editable" onclick="editCell(this, 'ppeItems', ${index}, 'country')">${item.country}</td>
                    <td class="editable" onclick="editCell(this, 'ppeItems', ${index}, 'issueDate')">${item.issueDate}</td>
                    <td class="editable" onclick="editCell(this, 'ppeItems', ${index}, 'expiryDate')">${item.expiryDate}</td>
                    <td class="editable" onclick="editCell(this, 'ppeItems', ${index}, 'status')">${item.status}</td>
                    <td class="editable" onclick="editCell(this, 'ppeItems', ${index}, 'condition')">${item.condition}</td>
                    <td>
                        <button class="btn-sm" onclick="deletePPE(${index})" style="background: #e74c3c; color: white;">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadContractorTable() {
            const table = document.getElementById('contractorTable');
            if (!table) return;
            
            let filteredContractors = currentFilter === 'All' ? contractors : contractors.filter(c => c.country === currentFilter);
            
            table.innerHTML = '';
            filteredContractors.forEach((contractor, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${contractor.id}</td>
                    <td class="editable" onclick="editCell(this, 'contractors', ${index}, 'company')">${contractor.company}</td>
                    <td class="editable" onclick="editCell(this, 'contractors', ${index}, 'contactPerson')">${contractor.contactPerson}</td>
                    <td class="editable" onclick="editCell(this, 'contractors', ${index}, 'country')">${contractor.country}</td>
                    <td class="editable" onclick="editCell(this, 'contractors', ${index}, 'workType')">${contractor.workType}</td>
                    <td class="editable" onclick="editCell(this, 'contractors', ${index}, 'startDate')">${contractor.startDate}</td>
                    <td class="editable" onclick="editCell(this, 'contractors', ${index}, 'endDate')">${contractor.endDate}</td>
                    <td class="editable" onclick="editCell(this, 'contractors', ${index}, 'safetyRating')">${contractor.safetyRating}</td>
                    <td>${contractor.attachments ? contractor.attachments.length : 0} files</td>
                    <td>
                        <button class="btn-sm" onclick="uploadContractorAttachment(${index})" style="margin-right: 0.5rem;">üìé</button>
                        <button class="btn-sm" onclick="deleteContractor(${index})" style="background: #e74c3c; color: white;">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadAuditTable() {
            const table = document.getElementById('auditTable');
            if (!table) return;
            
            let filteredAudits = currentFilter === 'All' ? audits : audits.filter(a => a.country === currentFilter);
            
            table.innerHTML = '';
            filteredAudits.forEach((audit, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${audit.id}</td>
                    <td class="editable" onclick="editCell(this, 'audits', ${index}, 'type')">${audit.type}</td>
                    <td class="editable" onclick="editCell(this, 'audits', ${index}, 'country')">${audit.country}</td>
                    <td class="editable" onclick="editCell(this, 'audits', ${index}, 'location')">${audit.location}</td>
                    <td class="editable" onclick="editCell(this, 'audits', ${index}, 'auditDate')">${audit.auditDate}</td>
                    <td class="editable" onclick="editCell(this, 'audits', ${index}, 'auditor')">${audit.auditor}</td>
                    <td class="editable" onclick="editCell(this, 'audits', ${index}, 'score')">${audit.score}</td>
                    <td class="editable" onclick="editCell(this, 'audits', ${index}, 'status')">${audit.status}</td>
                    <td class="editable" onclick="editCell(this, 'audits', ${index}, 'findings')">${audit.findings}</td>
                    <td>${audit.attachments ? audit.attachments.length : 0} files</td>
                    <td>
                        <button class="btn-sm" onclick="uploadAuditAttachment(${index})" style="margin-right: 0.5rem;">üìé</button>
                        <button class="btn-sm" onclick="deleteAudit(${index})" style="background: #e74c3c; color: white;">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadStandardsTable() {
            const table = document.getElementById('standardsTable');
            if (!table) return;
            
            table.innerHTML = '';
            standards.forEach((standard, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${standard.id}</td>
                    <td class="editable" onclick="editCell(this, 'standards', ${index}, 'name')">${standard.name}</td>
                    <td class="editable" onclick="editCell(this, 'standards', ${index}, 'code')">${standard.code}</td>
                    <td class="editable" onclick="editCell(this, 'standards', ${index}, 'type')">${standard.type}</td>
                    <td class="editable" onclick="editCell(this, 'standards', ${index}, 'industry')">${standard.industry}</td>
                    <td class="editable" onclick="editCell(this, 'standards', ${index}, 'status')">${standard.status}</td>
                    <td class="editable" onclick="editCell(this, 'standards', ${index}, 'effectiveDate')">${standard.effectiveDate}</td>
                    <td class="editable" onclick="editCell(this, 'standards', ${index}, 'remarks')">${standard.remarks}</td>
                    <td>
                        <button class="btn-sm" onclick="deleteStandard(${index})" style="background: #e74c3c; color: white;">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function populateEmployeeDropdown() {
            const select = document.getElementById('reportedBy');
            if (!select) return;
            
            select.innerHTML = '<option value="">Select employee</option>';
            employees.forEach(emp => {
                const option = document.createElement('option');
                option.value = emp.id;
                option.textContent = `${emp.name} (${emp.id})`;
                select.appendChild(option);
            });
        }

        function getEmployeeName(employeeId) {
            const employee = employees.find(e => e.id === employeeId);
            return employee ? employee.name : employeeId;
        }

        function editCell(cell, dataType, index, field) {
            if (editingCell) return;
            
            editingCell = {cell, dataType, index, field};
            const originalValue = cell.textContent;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'edit-input';
            input.value = originalValue;
            input.style.width = '100%';
            
            input.onblur = function() {
                saveCellEdit(this.value);
            };
            
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    saveCellEdit(this.value);
                }
            };
            
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            input.select();
        }

        function saveCellEdit(value) {
            if (!editingCell) return;
            
            const {cell, dataType, index, field} = editingCell;
            
            let dataArray;
            switch(dataType) {
                case 'employees': dataArray = employees; break;
                case 'incidents': dataArray = incidents; break;
                case 'trainings': dataArray = trainings; break;
                case 'ppeItems': dataArray = ppeItems; break;
                case 'contractors': dataArray = contractors; break;
                case 'audits': dataArray = audits; break;
                case 'standards': dataArray = standards; break;
                default: return;
            }
            
            if (dataArray[index]) {
                dataArray[index][field] = value;
                cell.textContent = value;
                saveAllData();
                updateStatistics();
                showToast('Success', `${field} updated successfully!`, 'success');
            }
            
            editingCell = null;
        }

        // Filter Functions
        function filterData(country) {
            currentFilter = country;
            
            // Update active button
            document.querySelectorAll('.country-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event?.target?.classList?.add('active');
            
            loadAllTables();
            updateStatistics();
            
            if (country !== 'All') {
                showToast('Filter Applied', `Showing data for ${country}`, 'warning');
            }
        }

        // Add New Items Functions
        function addEmployee() {
            const newId = `EMP-${new Date().getFullYear()}-${(employees.length + 1).toString().padStart(3, '0')}`;
            employees.push({
                id: newId,
                name: 'New Employee',
                position: '',
                country: 'South Africa',
                location: '',
                status: 'Active',
                training: 'Pending'
            });
            saveAllData();
            loadEmployeeTable();
            populateEmployeeDropdown();
            updateStatistics();
            showToast('Success', 'Employee added successfully!', 'success');
        }

        function addTraining() {
            const newId = `TRN-${new Date().getFullYear()}-${(trainings.length + 1).toString().padStart(3, '0')}`;
            trainings.push({
                id: newId,
                course: 'New Safety Training',
                employee: 'Select Employee',
                employeeId: '',
                country: 'South Africa',
                date: new Date().toISOString().split('T')[0],
                status: 'Pending',
                certificate: 'No',
                attachments: []
            });
            saveAllData();
            loadTrainingTable();
            updateStatistics();
            showToast('Success', 'Training added successfully!', 'success');
        }

        function addPPE() {
            const newId = `PPE-${new Date().getFullYear()}-${(ppeItems.length + 1).toString().padStart(3, '0')}`;
            ppeItems.push({
                id: newId,
                type: 'New Equipment',
                assignedTo: 'Select Employee',
                assignedToId: '',
                country: 'South Africa',
                issueDate: new Date().toISOString().split('T')[0],
                expiryDate: new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toISOString().split('T')[0],
                status: 'Active',
                condition: 'Good'
            });
            saveAllData();
            loadPPETable();
            showToast('Success', 'PPE item added successfully!', 'success');
        }

        function addContractor() {
            const newId = `CTR-${new Date().getFullYear()}-${(contractors.length + 1).toString().padStart(3, '0')}`;
            contractors.push({
                id: newId,
                company: 'New Contractor',
                contactPerson: '',
                country: 'South Africa',
                workType: '',
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toISOString().split('T')[0],
                safetyRating: 'A',
                attachments: []
            });
            saveAllData();
            loadContractorTable();
            showToast('Success', 'Contractor added successfully!', 'success');
        }

        function addAudit() {
            const newId = `AUD-${new Date().getFullYear()}-${(audits.length + 1).toString().padStart(3, '0')}`;
            audits.push({
                id: newId,
                type: 'Safety Audit',
                country: 'South Africa',
                location: '',
                auditDate: new Date().toISOString().split('T')[0],
                auditor: '',
                score: '0%',
                status: 'Scheduled',
                findings: '',
                attachments: []
            });
            saveAllData();
            loadAuditTable();
            showToast('Success', 'Audit scheduled successfully!', 'success');
        }

        function addStandard() {
            const newId = `STD-${new Date().getFullYear()}-${(standards.length + 1).toString().padStart(3, '0')}`;
            standards.push({
                id: newId,
                name: 'New Standard',
                code: 'NEW-STD',
                type: 'International',
                industry: 'General Industry',
                status: 'Pending',
                effectiveDate: new Date().toISOString().split('T')[0],
                remarks: ''
            });
            saveAllData();
            loadStandardsTable();
            showToast('Success', 'Standard added successfully!', 'success');
        }

        // Delete Functions
        function deleteEmployee(index) {
            if (confirm('Delete this employee?')) {
                employees.splice(index, 1);
                saveAllData();
                loadEmployeeTable();
                populateEmployeeDropdown();
                updateStatistics();
                showToast('Deleted', 'Employee deleted successfully!', 'success');
            }
        }

        function deleteIncident(index) {
            if (confirm('Delete this incident?')) {
                incidents.splice(index, 1);
                saveAllData();
                loadIncidentsTable();
                updateStatistics();
                showToast('Deleted', 'Incident deleted successfully!', 'success');
            }
        }

        function deleteTraining(index) {
            if (confirm('Delete this training record?')) {
                trainings.splice(index, 1);
                saveAllData();
                loadTrainingTable();
                updateStatistics();
                showToast('Deleted', 'Training deleted successfully!', 'success');
            }
        }

        function deletePPE(index) {
            if (confirm('Delete this PPE item?')) {
                ppeItems.splice(index, 1);
                saveAllData();
                loadPPETable();
                showToast('Deleted', 'PPE item deleted successfully!', 'success');
            }
        }

        function deleteContractor(index) {
            if (confirm('Delete this contractor?')) {
                contractors.splice(index, 1);
                saveAllData();
                loadContractorTable();
                showToast('Deleted', 'Contractor deleted successfully!', 'success');
            }
        }

        function deleteAudit(index) {
            if (confirm('Delete this audit?')) {
                audits.splice(index, 1);
                saveAllData();
                loadAuditTable();
                showToast('Deleted', 'Audit deleted successfully!', 'success');
            }
        }

        function deleteStandard(index) {
            if (confirm('Delete this standard?')) {
                standards.splice(index, 1);
                saveAllData();
                loadStandardsTable();
                showToast('Deleted', 'Standard deleted successfully!', 'success');
            }
        }

        // Upload Functions
        function uploadTrainingAttachment(index) {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.onchange = function(e) {
                const files = e.target.files;
                if (!trainings[index].attachments) {
                    trainings[index].attachments = [];
                }
                for (let file of files) {
                    trainings[index].attachments.push(file.name);
                }
                saveAllData();
                loadTrainingTable();
                showToast('Success', 'Attachment(s) uploaded successfully!', 'success');
            };
            input.click();
        }

        function uploadContractorAttachment(index) {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.onchange = function(e) {
                const files = e.target.files;
                if (!contractors[index].attachments) {
                    contractors[index].attachments = [];
                }
                for (let file of files) {
                    contractors[index].attachments.push(file.name);
                }
                saveAllData();
                loadContractorTable();
                showToast('Success', 'Attachment(s) uploaded successfully!', 'success');
            };
            input.click();
        }

        function uploadAuditAttachment(index) {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.onchange = function(e) {
                const files = e.target.files;
                if (!audits[index].attachments) {
                    audits[index].attachments = [];
                }
                for (let file of files) {
                    audits[index].attachments.push(file.name);
                }
                saveAllData();
                loadAuditTable();
                showToast('Success', 'Attachment(s) uploaded successfully!', 'success');
            };
            input.click();
        }

        // Incident Reporting
        function submitIncident() {
            const type = document.getElementById('incidentType').value;
            const severity = document.getElementById('incidentSeverity').value;
            const country = document.getElementById('incidentCountry').value;
            const location = document.getElementById('incidentLocation').value;
            const reportedBy = document.getElementById('reportedBy').value;
            const description = document.getElementById('incidentDescription').value;
            
            if (!type || !severity || !country || !location || !reportedBy || !description) {
                showToast('Error', 'Please fill all required fields!', 'error');
                return;
            }
            
            const newId = `INC-${new Date().getFullYear()}-${(incidents.length + 1).toString().padStart(3, '0')}`;
            incidents.push({
                id: newId,
                type: type,
                severity: severity,
                country: country,
                location: location,
                reportedBy: reportedBy,
                date: new Date().toISOString().split('T')[0],
                status: 'Reported',
                description: description
            });
            
            saveAllData();
            loadIncidentsTable();
            updateStatistics();
            
            // Clear form
            document.getElementById('incidentType').value = '';
            document.getElementById('incidentSeverity').value = '';
            document.getElementById('incidentCountry').value = '';
            document.getElementById('incidentLocation').value = '';
            document.getElementById('reportedBy').value = '';
            document.getElementById('incidentDescription').value = '';
            
            closeModal('reportIncidentModal');
            showToast('Success', 'Incident reported successfully!', 'success');
        }

        // Settings Functions
        function saveSettings() {
            // Save settings to localStorage
            const settings = {
                theme: document.getElementById('themeColor').value,
                emailNotifications: document.getElementById('emailNotifications').checked,
                pushNotifications: document.getElementById('pushNotifications').checked,
                reportReminders: document.getElementById('reportReminders').checked
            };
            localStorage.setItem('mms_settings', JSON.stringify(settings));
            
            showToast('Success', 'Settings saved successfully!', 'success');
            closeModal('settingsModal');
        }

        function backupData() {
            const backup = {
                employees: employees,
                incidents: incidents,
                trainings: trainings,
                ppeItems: ppeItems,
                contractors: contractors,
                audits: audits,
                standards: standards,
                backupDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(backup, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', `mms-backup-${new Date().toISOString().split('T')[0]}.json`);
            linkElement.click();
            
            showToast('Success', 'Backup created successfully!', 'success');
        }

        function restoreData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backup = JSON.parse(e.target.result);
                        employees = backup.employees || [];
                        incidents = backup.incidents || [];
                        trainings = backup.trainings || [];
                        ppeItems = backup.ppeItems || [];
                        contractors = backup.contractors || [];
                        audits = backup.audits || [];
                        standards = backup.standards || [];
                        
                        saveAllData();
                        loadAllTables();
                        updateStatistics();
                        showToast('Success', 'Data restored successfully!', 'success');
                    } catch (error) {
                        showToast('Error', 'Invalid backup file!', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function resetData() {
            if (confirm('This will reset all data to default values. Are you sure?')) {
                localStorage.clear();
                loadAllData();
                loadAllTables();
                updateStatistics();
                showToast('Success', 'All data reset to default!', 'success');
            }
        }

        // PDF Export Functions
        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Title
            doc.setFontSize(20);
            doc.text('MMS Health & Safety Report', 20, 20);
            doc.setFontSize(12);
            doc.text(`Generated: ${new Date().toLocaleDateString()}`, 20, 30);
            doc.text(`Filter: ${currentFilter}`, 20, 40);
            
            // Summary Statistics
            doc.setFontSize(16);
            doc.text('Summary Statistics', 20, 60);
            doc.setFontSize(12);
            doc.text(`Total Employees: ${employees.filter(e => currentFilter === 'All' || e.country === currentFilter).length}`, 20, 70);
            doc.text(`Lost Time Injuries: ${incidents.filter(i => (currentFilter === 'All' || i.country === currentFilter) && i.type === 'Lost Time Injury').length}`, 20, 80);
            doc.text(`Completed Trainings: ${trainings.filter(t => (currentFilter === 'All' || t.country === currentFilter) && t.status === 'Completed').length}`, 20, 90);
            
            // Export each table
            exportTableToPDF(doc, 'Employees', employees.filter(e => currentFilter === 'All' || e.country === currentFilter), 110);
            exportTableToPDF(doc, 'Incidents', incidents.filter(i => currentFilter === 'All' || i.country === currentFilter), 110 + 40);
            
            // Save PDF
            doc.save(`mms-safety-report-${new Date().toISOString().split('T')[0]}.pdf`);
            showToast('Success', 'PDF exported successfully!', 'success');
        }

        function exportTableToPDF(doc, title, data, yPosition) {
            if (data.length === 0) return yPosition;
            
            doc.addPage();
            doc.setFontSize(16);
            doc.text(title, 20, 20);
            
            const headers = Object.keys(data[0]);
            const rows = data.map(item => headers.map(header => item[header]));
            
            doc.autoTable({
                head: [headers],
                body: rows,
                startY: 30,
                theme: 'striped',
                headStyles: { fillColor: [26, 53, 104] }
            });
            
            return doc.lastAutoTable.finalY + 10;
        }

        // Modal Functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function showDashboard() {
            // Reload all data
            loadAllTables();
            updateStatistics();
        }

        // Toast Notification Functions
        function showToast(title, message, type) {
            const toast = document.getElementById('toast');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = document.getElementById('toastIcon');
            
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            toastIcon.textContent = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è';
            toast.style.borderLeftColor = type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#f39c12';
            
            toast.classList.add('show');
            
            setTimeout(() => {
                hideToast();
            }, 3000);
        }

        function hideToast() {
            const toast = document.getElementById('toast');
            toast.classList.remove('show');
        }

        // Event Listeners
        function setupEventListeners() {
            window.onclick = function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            };
            
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    const modals = document.querySelectorAll('.modal');
                    modals.forEach(modal => {
                        if (modal.style.display === 'block') {
                            modal.style.display = 'none';
                            document.body.style.overflow = 'auto';
                        }
                    });
                }
            });
        }
    </script>
</body>
</html>
